<!doctype html>
<html lang="en">

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>MikroScope</title>
    <link rel="stylesheet" href="./styles.css" />
  </head>

  <body>
    <div class="app-shell">
      <header class="topbar">
        <div class="title">
          <h1>MikroScope</h1>
        </div>
        <div class="topbar-actions">
          <button id="command-palette-button" class="button command-palette-button" type="button"
            aria-label="Open command palette" title="Command palette (Ctrl/Cmd+K)">
            Ctrl/Cmd+K
          </button>
          <button id="shortcuts-help-button" class="button icon-button" type="button" aria-label="Keyboard shortcuts"
            title="Keyboard shortcuts (?)">
            ?
          </button>
          <button id="theme-toggle" class="button icon-button" type="button" aria-label="Toggle dark/light mode"
            title="Toggle dark/light mode">
            ☾
          </button>
          <button id="reset-baseline-button" class="button icon-button" type="button"
            aria-label="Reset to baseline query" title="Reset to baseline query">
            ↺
          </button>
          <button id="refresh-button" class="button button-primary icon-button run-query-button" type="button"
            aria-label="Run Query" title="Run Query">
            ▶
          </button>
        </div>
      </header>

      <main class="layout">
        <section class="panel query-panel">
          <details class="details-panel query-details" open>
            <summary>Query Controls</summary>
            <div class="details-body">
              <div class="details-body-inner query-details-inner">
                <form id="remote-query-form" class="query-command-row">
                  <label>
                    From
                    <div class="datetime-control">
                      <input id="query-from" type="date" />
                      <input id="query-from-time" type="time" step="1" aria-label="From time" />
                    </div>
                  </label>
                  <label>
                    To
                    <div class="datetime-control">
                      <input id="query-to" type="date" />
                      <input id="query-to-time" type="time" step="1" aria-label="To time" />
                    </div>
                  </label>
                  <label>
                    Level
                    <select id="query-level">
                      <option value="">Any</option>
                      <option value="DEBUG">DEBUG</option>
                      <option value="INFO">INFO</option>
                      <option value="WARN">WARN</option>
                      <option value="ERROR">ERROR</option>
                    </select>
                  </label>
                  <label>
                    Audit
                    <select id="query-audit">
                      <option value="">Any</option>
                      <option value="true">Audit only</option>
                      <option value="false">Non-audit</option>
                    </select>
                  </label>
                  <label>
                    Limit
                    <input id="query-limit" type="number" min="1" max="1000" value="1000" />
                  </label>
                </form>
                <details class="query-advanced-drawer">
                  <summary>Advanced</summary>
                  <div class="query-advanced-body">
                    <div class="chip-actions">
                      <div class="range-actions">
                        <span class="range-label">Quick range</span>
                        <button type="button" class="chip-button" data-range-hours="1">1h</button>
                        <button type="button" class="chip-button" data-range-hours="6">6h</button>
                        <button type="button" class="chip-button" data-range-hours="24">24h</button>
                        <button type="button" class="chip-button" data-range-hours="168">7d</button>
                        <button type="button" class="chip-button" data-range-hours="720">30d</button>
                        <button type="button" class="chip-button" data-range-all="true">All</button>
                      </div>
                      <div class="preset-actions">
                        <span class="range-label">Pinned queries</span>
                        <button type="button" class="chip-button" data-preset="errors24h">
                          Errors 24h
                        </button>
                        <button type="button" class="chip-button" data-preset="audit7d">
                          Audit 7d
                        </button>
                      </div>
                    </div>
                    <div class="saved-query-row">
                      <div class="saved-query-group">
                        <label>
                          Query name
                          <input id="saved-query-name" type="text" placeholder="e.g. Checkout errors (24h)" />
                        </label>
                        <div class="inline-actions">
                          <button id="save-query-button" type="button" class="button">
                            Save Query
                          </button>
                        </div>
                      </div>
                      <div class="saved-query-gap" aria-hidden="true"></div>
                      <div class="saved-query-group">
                        <label>
                          Saved query
                          <select id="saved-query-select">
                            <option value="">Select...</option>
                          </select>
                        </label>
                        <div class="inline-actions saved-query-actions">
                          <button id="copy-view-url-button" type="button" class="button copy-json-button">
                            Copy View URL
                          </button>
                          <button id="delete-saved-query-button" type="button" class="button">
                            Delete
                          </button>
                        </div>
                      </div>
                    </div>

                    <div class="recent-scope-row">
                      <label>
                        Recent scope
                        <select id="recent-scope-select">
                          <option value="">Select...</option>
                        </select>
                      </label>
                      <div class="inline-actions saved-query-actions">
                        <button id="apply-recent-scope-button" type="button" class="button">
                          Restore Scope
                        </button>
                      </div>
                    </div>
                  </div>
                </details>
              </div>
            </div>
          </details>

          <details class="details-panel inspect-panel">
            <summary>Inspect</summary>
            <div class="details-body">
              <div class="details-body-inner inspect-details-inner">
                <div class="trace-grid">
                  <label>
                    Key
                    <select id="trace-field">
                      <option value="auto">Auto</option>
                      <option value="correlationId">correlationId</option>
                      <option value="requestId">requestId</option>
                    </select>
                  </label>
                  <label>
                    Trace / Correlation
                    <input id="trace-value" placeholder="corr-... or req-..." />
                  </label>
                  <div class="inline-actions trace-actions">
                    <button id="trace-clear-button" type="button" class="button">Clear</button>
                    <button id="trace-go-button" type="button" class="button">Go to Trace</button>
                  </div>
                </div>

                <details class="inspect-subdrawer">
                  <summary>Local Filter & Sort</summary>
                  <div class="inspect-subdrawer-body">
                    <form id="local-filter-form" class="advanced-grid">
                      <label>
                        Field
                        <input id="local-field" list="field-options" placeholder="* (any field)" />
                        <datalist id="field-options"></datalist>
                      </label>
                      <label>
                        Value
                        <input id="local-value" placeholder="contains..." />
                      </label>
                      <label>
                        Match
                        <select id="local-match-mode">
                          <option value="contains">Contains</option>
                          <option value="equals">Equals</option>
                        </select>
                      </label>
                      <label>
                        Sort field
                        <select id="sort-field"></select>
                      </label>
                      <label>
                        Sort direction
                        <select id="sort-direction">
                          <option value="desc">Desc</option>
                          <option value="asc">Asc</option>
                        </select>
                      </label>
                      <div class="inline-actions">
                        <button id="clear-local-button" type="button" class="button">
                          Clear Local Filter
                        </button>
                      </div>
                    </form>
                  </div>
                </details>

                <details class="inspect-subdrawer">
                  <summary>Trace List</summary>
                  <div class="inspect-subdrawer-body">
                    <div class="trace-list-wrap">
                      <p class="range-label">Recent traces from current result set</p>
                      <div id="trace-list" class="trace-list"></div>
                    </div>
                  </div>
                </details>

                <input id="query-field" type="hidden" />
                <input id="query-value" type="hidden" />
              </div>
            </div>
          </details>
        </section>

        <section class="panel workspace-panel">
          <div class="workspace-head">
            <div class="view-tabs">
              <button class="view-tab is-active" type="button" data-view-target="stream">Stream</button>
              <button class="view-tab" type="button" data-view-target="correlations">Correlations</button>
              <button class="view-tab" type="button" data-view-target="timeline">Timeline</button>
            </div>
            <div class="workspace-head-actions">
              <p id="status-line" class="panel-note">Ready</p>
              <button id="scope-back-button" class="button icon-button scope-back-button" type="button"
                aria-label="Back to previous scope" title="Back to previous scope">
                ↶
              </button>
              <button id="stream-expand-button" class="button icon-button stream-expand-icon" type="button"
                aria-label="Expand Stream" title="Expand Stream">
                ⤢
              </button>
            </div>
          </div>
          <div id="active-query-chips" class="query-chips"></div>
          <div id="scope-trail" class="scope-trail"></div>

          <section id="view-stream" class="view-pane is-active">
            <section class="metrics metrics-inline">
              <div class="metric-card">
                <div class="label">Loaded</div>
                <div id="metric-loaded" class="value">0</div>
              </div>
              <div class="metric-card">
                <div class="label">Visible</div>
                <div id="metric-visible" class="value">0</div>
              </div>
              <div class="metric-card">
                <div class="label">Errors</div>
                <div id="metric-errors" class="value">0</div>
              </div>
              <div class="metric-card">
                <div class="label">Correlations</div>
                <div id="metric-correlations" class="value">0</div>
              </div>
            </section>
            <div class="stream-actions">
              <button id="stream-clear-button" class="button" type="button">Clear Scope</button>
              <button id="stream-load-more-button" class="button" type="button" hidden>Load More</button>
            </div>
            <div class="table-wrap">
              <table class="logs-table">
                <thead>
                  <tr>
                    <th></th>
                    <th>Timestamp</th>
                    <th>Level</th>
                    <th>Event</th>
                    <th>Correlation</th>
                    <th>Component</th>
                    <th>Message</th>
                  </tr>
                </thead>
                <tbody id="logs-tbody"></tbody>
              </table>
            </div>
            <details class="details-panel insights-details">
              <summary>Insights</summary>
              <div class="details-body">
                <div class="details-body-inner">
                  <section class="split">
                    <div>
                      <h2>Level Distribution</h2>
                      <div id="level-distribution" class="bars"></div>
                    </div>
                    <div>
                      <h2>Top Events</h2>
                      <ol id="top-events" class="simple-list"></ol>
                    </div>
                    <div>
                      <h2>Top Components</h2>
                      <ol id="top-components" class="simple-list"></ol>
                    </div>
                    <div>
                      <h2>Error Correlations</h2>
                      <ol id="error-correlations" class="simple-list"></ol>
                    </div>
                  </section>
                </div>
              </div>
            </details>
          </section>

          <section id="view-correlations" class="view-pane">
            <div id="correlation-groups" class="correlation-grid"></div>
          </section>

          <section id="view-timeline" class="view-pane">
            <div class="timeline-toolbar">
              <label class="timeline-bucket-control" for="timeline-bucket-size">
                Bucket
                <select id="timeline-bucket-size">
                  <option value="auto">Auto fit</option>
                  <option value="60000">1m</option>
                  <option value="300000">5m</option>
                  <option value="900000">15m</option>
                  <option value="1800000">30m</option>
                  <option value="3600000">1h</option>
                  <option value="10800000">3h</option>
                  <option value="21600000">6h</option>
                  <option value="43200000">12h</option>
                  <option value="86400000">1d</option>
                  <option value="172800000">2d</option>
                  <option value="604800000">7d</option>
                  <option value="1209600000">14d</option>
                  <option value="2592000000">30d</option>
                </select>
              </label>
            </div>
            <div id="timeline" class="timeline-view"></div>
            <div id="timeline-tooltip" class="timeline-tooltip" hidden></div>
          </section>
        </section>
      </main>
    </div>

    <dialog id="stream-modal" class="stream-modal">
      <div class="stream-modal-header">
        <strong>Log Stream</strong>
        <div class="stream-modal-actions">
          <button id="stream-modal-clear-button" class="button" type="button" hidden>Clear Scope</button>
          <button id="stream-modal-close" class="button icon-button stream-modal-close-button" type="button"
            aria-label="Close expanded stream" title="Close expanded stream">
            ×
          </button>
        </div>
      </div>
      <div class="stream-modal-body">
        <table class="logs-table logs-table-modal">
          <thead>
            <tr>
              <th></th>
              <th>Timestamp</th>
              <th>Level</th>
              <th>Event</th>
              <th>Correlation</th>
              <th>Component</th>
              <th>Message</th>
            </tr>
          </thead>
          <tbody id="logs-modal-tbody"></tbody>
        </table>
      </div>
    </dialog>

    <dialog id="shortcuts-modal" class="shortcuts-modal" aria-label="Keyboard shortcuts">
      <div class="shortcuts-modal-header">
        <strong>Keyboard Shortcuts</strong>
        <button id="shortcuts-modal-close" class="button icon-button stream-modal-close-button" type="button"
          aria-label="Close keyboard shortcuts" title="Close keyboard shortcuts">
          ×
        </button>
      </div>
      <div class="shortcuts-modal-body">
        <ul class="shortcuts-list">
          <li><kbd class="shortcut-key">Ctrl/Cmd+K</kbd><span>Open command palette</span></li>
          <li><kbd class="shortcut-key">Q</kbd><span>Toggle query controls</span></li>
          <li><kbd class="shortcut-key">I</kbd><span>Toggle inspect panel</span></li>
          <li><kbd class="shortcut-key">S</kbd><span>Open stream view</span></li>
          <li><kbd class="shortcut-key">C</kbd><span>Open correlations view</span></li>
          <li><kbd class="shortcut-key">T</kbd><span>Open timeline view</span></li>
          <li><kbd class="shortcut-key">U</kbd><span>Copy current view URL</span></li>
          <li><kbd class="shortcut-key">Enter</kbd><span>Run query</span></li>
          <li><kbd class="shortcut-key">Space</kbd><span>Toggle expanded stream</span></li>
          <li><kbd class="shortcut-key">?</kbd><span>Toggle this shortcuts panel</span></li>
        </ul>
        <p class="panel-note">
          Shortcuts are disabled while typing in inputs, selects, text areas, buttons, and editable fields.
        </p>
      </div>
    </dialog>

    <dialog id="command-palette-modal" class="command-palette-modal" aria-label="Command palette">
      <div class="command-palette-head">
        <label for="command-palette-input" class="command-palette-label">Actions</label>
        <input id="command-palette-input" class="command-palette-input" type="text" autocomplete="off"
          placeholder="Type to filter actions..." />
      </div>
      <div id="command-palette-list" class="command-palette-list" role="listbox"></div>
      <p class="command-palette-foot panel-note">
        ↑↓ navigate · Enter run · Esc close
      </p>
    </dialog>

    <script src="./app.js"></script>
  </body>

</html>